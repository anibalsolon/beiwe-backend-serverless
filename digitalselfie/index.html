<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="./static/assets/img/favicons/favicon-32x32.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Upload your screenshots">
    <meta name="author" content="Cameron Craddock">
    <link rel="stylesheet" href="./static/css/sticky-footer.css">
    <link rel="stylesheet" href="./static/css/bootstrap.min.css">
    <title>Upload your digital selfie!</title>
</head>

<body>

    <main role="main" class="container">
        <div class="container">
            <div style="background:rgb(191,87,0) !important; color:white !important;" class="jumbotron">
                <h1>Upload Your Digital Selfie</h1>
                <p class="font-italic">Behavioral & Psychological Responses to the COVID-19 Pandemic: A SmartPhone Sensing Study</p>
            </div>

            <form class="border border-0 pt-4 pl-4 pr-4 pb-1 bg-white" action="https://beiwe-py3.ut-wcwh.org/upload_digital_selfie" method="POST" enctype="multipart/form-data">
                <div id="callback" class="alert">
                </div>

                <div class="form-row form-group">
                    <input type="user-text-field" class="form-control" name="username" placeholder="Beiwe Username" autocomplete="username" required>
                </div>
                <div class="form-row form-group">
                    <input id="password-text-field" type="password" class="form-control" name="password" placeholder="Beiwe Password" autocomplete="current-password" required>
                </div>

                <div class="form-row form-group custom-file">
                    <input type="file" class="custom-file-input" id="customFile" name="user_files" multiple required>
                    <label class="custom-file-label pr-2" for="customFile">Choose file(s)</label>
                </div>

		<div class="form-row form-group ml-5 mt-2 mb-0" id="form-check">
                    <input type="checkbox" class="form-check-input" value="1" id="rr-1" name="rr[]" required>
                    <label class="form-check-label" for="rr-1">I have verified that these images contain only screen shots of my mobile
			    phone App usage that have been edited to remove any personally identifying information. The images do not
			    include any other content, specifically nothing of an offensive nature.</label>
                </div>

                <div class="form-row form-group">
                    <button type="submit" name="upload" value="upload" id="upload" class="btn btn-block btn-success float-right mt-3">Upload</button>
                </div>
            </form>

            <p class="mt-5">Please upload a "digital selfie" of your app usage by completing the following steps (or a <a href="https://drive.google.com/open?id=1BnJnmM-GDughAHlyJnaH58sY05_Vhs1jR0yviHeAR6o"> more detailed step-by-step guide).</a> If you have problems, please email <a href="mailto:utcovid19study@austin.utexas.edu">utcovid19study@austin.utexas.edu</a></p>
            <h4>iPhone instructions:</h4>
            <ol>
                <li>Open your phone's "Settings" app.</li>
                <li>Select "Screen Time."</li>
                <li>Select "See All Activity."</li>
                <li>Make sure you are toggled to view your usage for the week, NOT the day.</li>
                <li>Take a screenshot(s) of your app usage for the past week by pressing and
                    holding the home and power buttons simultaneously. Please crop the screenshot
		    to remove your device's name (e.g. Richard's iPhone) from the top of the image. 
		    You may need to take multiple screenshots to capture all the apps you used. </li>
                <li>Enter your Beiwe username and password above. </li>
                <li>Select the "Choose file" button above and select your screenshots. Check the box
		    confirming that you are uploading app usage screenshots that have been cropped 
		    to remove personally identifying information and not anything of an offensive 
		    nature. Select "Upload."</li>
                <li>Go back to the Beiwe app, select "uploaded my digital selfie!" and submit. </li>
            </ol>
 
            <h4>Android instructions:</h4>
            <ol>
                <li>Open your phone's "Settings" app.</li>
                <li>Select "Battery."</li>
                <li>Select the 3-dot menu, and select to "Battery usage."</li>
                <li>Select the 3 dot menu again, and choose "Show full device usage."</li>
                <li>Take a screenshot(s) of your app usage for the past week by pressing and holding the volume and
                    power buttons simultaneously. You will need to take at least 7 screenshots: one for each day
                    of the past week.</li>
                <li>Enter your Beiwe username and password above. </li>
                <li>Select the "Choose file" button above, select your screenshots, and select "Upload."</li>
                <li>Go back to the Beiwe app, select "uploaded my digital selfie!" and submit.</li>
            </ol>
        </div>
    </main>

    <footer class="footer">
        <div class="container text-center">
            <p class="font-italic">Copyright 2020, The University of Texas at Austin, <a href="https://bridgingbarriers.utexas.edu/whole-communities-whole-health/">Whole Communities Whole Health</p>
        </div>
    </footer>

    <script src="./static/javascript/jquery-3.5.0.min.js"></script>
    <script src="./static/javascript/popper.js"></script>
    <script src="./static/javascript/bootstrap.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            $('.custom-file input').change(function (e) {
		let total_file_size = 0;
		for (index = 0; index < e.target.files.length; index++) {
                    total_file_size += e.target.files[index].size / 1024 / 1024;
                }
		    $(this).next('.custom-file-label').removeClass('alert-danger alert-success').html('');

		    if(total_file_size > 5) {
		        $(this).next('.custom-file-label').addClass('alert-danger').html(`${e.target.files.length} file(s) totalling ${total_file_size.toPrecision(4)} MB > 5MB`);
		    } else {
		        $(this).next('.custom-file-label').addClass('alert-success').html(`${e.target.files.length} file(s) totalling ${total_file_size.toPrecision(4)} MB`);
		    }

            });
            $('form').submit(function (e) {
                e.preventDefault();

                $('#callback')
                    .removeClass('alert-danger alert-success')
                    .html('');

                var data = new FormData(this);
		let total_file_size = 0;

		all_files = data.getAll("user_files")
		for (index = 0; index < all_files.length; index++) {
                    total_file_size += all_files[index].size / 1024 / 1024;
                }
		if (total_file_size < 5) {
		    console.log(`Uploading ${total_file_size} MB in ${all_files.length} files`);
                    $.ajax({
                        url: this.action,
                        data: data,
                        processData: false,
                        contentType: false,
                        type: 'POST',
                        success: function(response){
                            $('#callback')
                                .addClass('alert-success')
                                .html('Digital selfie upload completed successfully!');
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
	                     console.log(xhr.responseText);
			     var message = 'Digital selfie upload failed to load! '
	                     if (xhr.responseText){
	                         message += JSON.parse(xhr.responseText);
	                     }
	                     console.log(message)
    
                            $('#callback')
                                .addClass('alert-danger')
                                .html(message);
                        }
                    });
		} else {
		    $('#callback')
			.addClass('alert-danger')
				.html('Total size of selected files(s) is larger than 5MB upload limit.');
		}
            });
        });

    </script>

</body>

</html>
